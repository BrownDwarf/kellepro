FUNCTION readmagespec,filename         ;this function takes in the name of a sloan
                                        ;spectra fits file and returns a 3 by X array
                                        ;called datastructure, where X is the number
                                        ;of data points measured.  datastructure(0,*)
                                        ;gives the wavelength information in
                                        ;air wavelengths, (1,*) gives
                                        ;flux, and (2,*) gives noise information.
basename = STRMID(filename, 0, (STRLEN(filename)-1-6)) 

data = MRDFITS(filename,0, header, /SILENT )      ;read data into data, header into header
error = MRDFITS(basename+'_E.fits', 0, /SILENT)

basewave = SXPAR( header,'CRVAL1' )     ;find the starting wavelength of the spectrum in weird sloan units
step = SXPAR( header,'CDELT1' )         ;find how big the wavelength step is in weird sloan units
nsteps = SXPAR( header,'NAXIS1' )       ;find the # of pixels in the spectra
wave = 10.0^( basewave + FINDGEN( nsteps ) * step )     ;now create an array for the wavelength values...

                                        ;convert the wavelengths to air wavelengths
datastructure = FLTARR(3,nsteps)        ;create a data structure to send back all
                                                ;the info we've gathered.
datastructure[0,*] = wave               ;fill it with wavelength
datastructure[1,*] = REFORM( data[*,0] );flux
datastructure[2,*] = REFORM( error );noise
 
RETURN,datastructure            ;send it back up the pipe!

END
